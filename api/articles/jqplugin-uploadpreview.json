{"title":"图片上传本地预览jquery插件","slug":"jqplugin-uploadpreview","date":"2015-05-07T10:11:00.000Z","updated":"2016-11-12T19:19:41.771Z","comments":true,"path":"api/articles/jqplugin-uploadpreview.json","excerpt":"<blockquote><p>网上找到的一段代码，经过一番测试修改，兼容了IE7+、火狐、谷歌。<br>并且扩展了多尺寸预览功能，可完美搭配 <a href=\"http://code.ciaoca.com/jquery/jcrop/\">jquery.Jcrop</a> 插件进行图像裁剪。<br>","content":"<blockquote><p>网上找到的一段代码，经过一番测试修改，兼容了IE7+、火狐、谷歌。<br>并且扩展了多尺寸预览功能，可完美搭配 <a href=\"http://code.ciaoca.com/jquery/jcrop/\" target=\"_blank\" rel=\"external\">jquery.Jcrop</a> 插件进行图像裁剪。<br><a id=\"more\"></a></p></blockquote><h3 id=\"插件代码\"><a href=\"#插件代码\" class=\"headerlink\" title=\"插件代码\"></a>插件代码</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>) </span>&#123;</div><div class=\"line\">    jQuery.fn.extend(&#123;</div><div class=\"line\">        <span class=\"attr\">uploadPreview</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">opts</span>) </span>&#123;</div><div class=\"line\">            opts = jQuery.extend(&#123;</div><div class=\"line\">                <span class=\"attr\">width</span>: <span class=\"literal\">null</span>,    </div><div class=\"line\">                <span class=\"attr\">height</span>: <span class=\"literal\">null</span>,</div><div class=\"line\">                <span class=\"attr\">imgDiv</span>: <span class=\"string\">\"#imgDiv\"</span>,  </div><div class=\"line\">                <span class=\"attr\">anyTarget</span>: <span class=\"literal\">null</span>,    </div><div class=\"line\">                <span class=\"attr\">maxSize</span>: <span class=\"number\">300</span>,       </div><div class=\"line\">                <span class=\"attr\">imgType</span>: [<span class=\"string\">\"gif\"</span>, <span class=\"string\">\"jpeg\"</span>, <span class=\"string\">\"jpg\"</span>, <span class=\"string\">\"bmp\"</span>, <span class=\"string\">\"png\"</span>],  </div><div class=\"line\">                <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"keyword\">return</span> <span class=\"literal\">false</span>; &#125;  </div><div class=\"line\">            &#125;, opts || &#123;&#125;);</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">var</span> _this = $(<span class=\"keyword\">this</span>);</div><div class=\"line\">            <span class=\"keyword\">var</span> imgDiv = $(opts.imgDiv);</div><div class=\"line\">            opts.width &amp;amp;&amp;amp; imgDiv.width(opts.width);</div><div class=\"line\">            opts.height &amp;amp;&amp;amp; imgDiv.height(opts.height);</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">var</span> isIE = navigator.appName == <span class=\"string\">'Microsoft Internet Explorer'</span>, </div><div class=\"line\">                brVersion = navigator.appVersion, version;</div><div class=\"line\">            isIE &amp;amp;&amp;amp; (version = brVersion.split(<span class=\"string\">';'</span>)[<span class=\"number\">1</span>].replace(<span class=\"regexp\">/MSIE[ ]/g</span>,<span class=\"string\">''</span>).replace(<span class=\"string\">'.0'</span>,<span class=\"string\">''</span>));</div><div class=\"line\"></div><div class=\"line\">            handle = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">                <span class=\"keyword\">var</span> img = imgDiv.find(<span class=\"string\">'img'</span>);</div><div class=\"line\">                opts.anyTarget &amp;amp;&amp;amp; $.each(opts.anyTarget.split(<span class=\"string\">','</span>), <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">index, val</span>) </span>&#123;</div><div class=\"line\">                    $(val).html(img.clone());</div><div class=\"line\">                &#125;);</div><div class=\"line\">                img.width(opts.width).height(opts.height);</div><div class=\"line\">                opts.callback(img);</div><div class=\"line\">            &#125;,</div><div class=\"line\"></div><div class=\"line\">            createImg = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">                imgDiv.html(<span class=\"string\">''</span>);</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">var</span> img = $(<span class=\"string\">\"&lt;img /&gt;\"</span>);</div><div class=\"line\">                imgDiv.append(img);</div><div class=\"line\">                <span class=\"keyword\">return</span> img;</div><div class=\"line\">            &#125;,</div><div class=\"line\"></div><div class=\"line\">            _this.change(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.value) &#123;</div><div class=\"line\">                    <span class=\"keyword\">if</span> (!<span class=\"built_in\">RegExp</span>(<span class=\"string\">\"\\.(\"</span> + opts.imgType.join(<span class=\"string\">\"|\"</span>) + <span class=\"string\">\")$\"</span>, <span class=\"string\">\"i\"</span>).test(<span class=\"keyword\">this</span>.value.toLowerCase())) &#123;</div><div class=\"line\">                        alert(<span class=\"string\">\"图片类型必须是\"</span> + opts.imgType.join(<span class=\"string\">\"，\"</span>) + <span class=\"string\">\"中的一种\"</span>);</div><div class=\"line\">                        <span class=\"keyword\">this</span>.value = <span class=\"string\">\"\"</span>;</div><div class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">                    &#125;</div><div class=\"line\"></div><div class=\"line\">                    <span class=\"keyword\">if</span> (isIE &amp;amp;&amp;amp; version &lt; <span class=\"number\">10</span>) &#123;</div><div class=\"line\"></div><div class=\"line\">                        <span class=\"keyword\">if</span> (version == <span class=\"number\">6</span>) &#123;</div><div class=\"line\"></div><div class=\"line\">                            <span class=\"keyword\">var</span> image = <span class=\"keyword\">new</span> Image();</div><div class=\"line\">                            image.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">                                <span class=\"keyword\">if</span>( (image.fileSize/<span class=\"number\">1024</span>) &gt; opts.maxSize) &#123;</div><div class=\"line\">                                    alert(<span class=\"string\">'图片大小不能超过'</span>+opts.maxSize+<span class=\"string\">'K'</span>);</div><div class=\"line\">                                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">                                &#125;</div><div class=\"line\">                            &#125;</div><div class=\"line\">                            image.src = <span class=\"string\">'file:///'</span> + <span class=\"keyword\">this</span>.value;</div><div class=\"line\"></div><div class=\"line\">                            createImg().attr(<span class=\"string\">'src'</span>, image.src);</div><div class=\"line\">                            handle();</div><div class=\"line\">                        &#125;  <span class=\"keyword\">else</span> &#123;</div><div class=\"line\"></div><div class=\"line\">                            <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.selection.createRange().text || $(<span class=\"keyword\">this</span>).val();</div><div class=\"line\">                            <span class=\"keyword\">var</span> image = $(<span class=\"string\">'&lt;img /&gt;'</span>)</div><div class=\"line\">                            image.load(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">                                <span class=\"keyword\">if</span>( (image.fileSize/<span class=\"number\">1024</span>) &gt; opts.maxSize) &#123;</div><div class=\"line\">                                    alert(<span class=\"string\">'图片大小不能超过'</span>+opts.maxSize+<span class=\"string\">'K'</span>);</div><div class=\"line\">                                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">                                &#125;</div><div class=\"line\">                            &#125;);</div><div class=\"line\">                            image.attr(<span class=\"string\">'src'</span>, img);                           </div><div class=\"line\">                            imgDiv.html(<span class=\"string\">''</span>);           </div><div class=\"line\"></div><div class=\"line\">                            image.css(&#123; <span class=\"attr\">filter</span>: <span class=\"string\">\"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='\"</span>+img+<span class=\"string\">\"')\"</span> &#125;);</div><div class=\"line\">                            imgDiv.append(image);</div><div class=\"line\">                            setTimeout(handle, <span class=\"number\">100</span>);                            </div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                    <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                        <span class=\"keyword\">var</span> img;</div><div class=\"line\">                        <span class=\"keyword\">try</span>&#123;   </div><div class=\"line\">                            <span class=\"keyword\">var</span> file = <span class=\"literal\">null</span>;</div><div class=\"line\">                            <span class=\"keyword\">var</span> size = <span class=\"number\">0</span>;</div><div class=\"line\">                            <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.files &amp;amp;&amp;amp; <span class=\"keyword\">this</span>.files[<span class=\"number\">0</span>] )&#123;</div><div class=\"line\">                                file = <span class=\"keyword\">this</span>.files[<span class=\"number\">0</span>]; </div><div class=\"line\">                                size = file.size;</div><div class=\"line\">                            &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.files &amp;amp;&amp;amp; <span class=\"keyword\">this</span>.files.item(<span class=\"number\">0</span>)) &#123;                                </div><div class=\"line\">                                file = <span class=\"keyword\">this</span>.files.item(<span class=\"number\">0</span>);   </div><div class=\"line\">                                size = file.fileSize;</div><div class=\"line\">                            &#125; </div><div class=\"line\"></div><div class=\"line\">                            <span class=\"keyword\">if</span>((size/<span class=\"number\">1024</span>) &gt; opts.maxSize)&#123;</div><div class=\"line\">                                alert(<span class=\"string\">'图片大小不能超过'</span>+opts.maxSize+<span class=\"string\">'K'</span>);</div><div class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">                            &#125;</div><div class=\"line\"></div><div class=\"line\">                            img = createImg();</div><div class=\"line\"></div><div class=\"line\">                            <span class=\"comment\">//Firefox 因安全性问题已无法直接通过input[file].value 获取完整的文件路径</span></div><div class=\"line\">                            <span class=\"keyword\">try</span>&#123;</div><div class=\"line\">                                <span class=\"comment\">//Firefox7.0 以下                             </span></div><div class=\"line\">                                img.attr(<span class=\"string\">'src'</span>, file.getAsDataURL());</div><div class=\"line\">                            &#125;<span class=\"keyword\">catch</span>(e)&#123;</div><div class=\"line\">                                <span class=\"comment\">//Firefox8.0以上                              </span></div><div class=\"line\">                                img.attr(<span class=\"string\">'src'</span>, <span class=\"built_in\">window</span>.URL.createObjectURL(file));</div><div class=\"line\">                            &#125;</div><div class=\"line\"></div><div class=\"line\">                            img.css(&#123; <span class=\"string\">\"vertical-align\"</span>: <span class=\"string\">\"middle\"</span> &#125;);</div><div class=\"line\">                            setTimeout(handle, <span class=\"number\">100</span>);</div><div class=\"line\">                        &#125;<span class=\"keyword\">catch</span>(e)&#123;                          </div><div class=\"line\">                            <span class=\"comment\">//支持html5的浏览器,比如高版本的firefox、chrome、ie10</span></div><div class=\"line\">                            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.files &amp;amp;&amp;amp; <span class=\"keyword\">this</span>.files[<span class=\"number\">0</span>]) &#123;                          </div><div class=\"line\">                                <span class=\"keyword\">if</span>((<span class=\"keyword\">this</span>.files[<span class=\"number\">0</span>].size/<span class=\"number\">1024</span>) &gt; opts.maxSize)&#123;</div><div class=\"line\">                                    alert(<span class=\"string\">'图片大小不能超过'</span>+opts.maxSize+<span class=\"string\">'K'</span>);</div><div class=\"line\">                                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">                                &#125;</div><div class=\"line\"></div><div class=\"line\">                                <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader(); </div><div class=\"line\">                                reader.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;                                      </div><div class=\"line\">                                    imgDiv.attr(<span class=\"string\">'src'</span>, e.target.result);  </div><div class=\"line\">                                &#125;;</div><div class=\"line\">                                reader.readAsDataURL(<span class=\"keyword\">this</span>.files[<span class=\"number\">0</span>]); </div><div class=\"line\">                                setTimeout(handle, <span class=\"number\">100</span>);</div><div class=\"line\">                            &#125;  </div><div class=\"line\">                        &#125;;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;)(jQuery);</div></pre></td></tr></table></figure><h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><ul><li>width: 图片容器宽度；</li><li>height: 图片容器高度；</li><li>imgDiv: 图片预览容器；</li><li>anyTarget: 其他关联容器，多个容器逗号隔开；</li><li>maxSize: 图片大小限制，单位KB；</li><li>imgType: 图片类型限制；</li><li>callback: 预览成功后的回调，参数 img(预览的图片节点，jquery类型)。</li></ul><h3 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"IE=edge,chrome=1\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>图片上传预览<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"http://cdn.bootcss.com/jquery-jcrop/0.9.12/css/jquery.Jcrop.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span>&gt;</span><span class=\"css\"></span></div><div class=\"line\">    <span class=\"selector-class\">.fl</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">float</span>: left;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.fr</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">float</span>: right;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.logo-wrap</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">overflow</span>: hidden;</div><div class=\"line\">        <span class=\"attribute\">margin</span>: <span class=\"number\">30px</span> <span class=\"number\">0</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.logo-350</span>, <span class=\"selector-class\">.logo-350</span> <span class=\"selector-tag\">img</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">350px</span>;</div><div class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">350px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.logo-350</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">margin-right</span>: <span class=\"number\">30px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.logo-200</span>, <span class=\"selector-class\">.logo-200</span> <span class=\"selector-tag\">img</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</div><div class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.logo-200</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.logo-200-wrap</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.logo-100</span>, <span class=\"selector-class\">.logo-100</span> <span class=\"selector-tag\">img</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</div><div class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"selector-class\">.logo-60</span>, <span class=\"selector-class\">.logo-60</span> <span class=\"selector-tag\">img</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">60px</span>;</div><div class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">60px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"selector-class\">.logo-350</span>, <span class=\"selector-class\">.logo-200</span>, <span class=\"selector-class\">.logo-100</span>, <span class=\"selector-class\">.logo-60</span>, <span class=\"selector-class\">.qrcode</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ddd</span>;</div><div class=\"line\">        <span class=\"attribute\">overflow</span>: hidden;</div><div class=\"line\">    &#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"上传文件\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"file\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"logo-wrap\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fl logo-350\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fl logo-200-wrap\"</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"logo-200\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fl logo-100\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fr logo-60\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://ysdn-wordpress.stor.sinaapp.com/js/jquery.uploadPreview.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://cdn.bootcss.com/jquery-jcrop/0.9.12/js/jquery.Jcrop.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\">  </span></div><div class=\"line\"><span class=\"comment\">//&lt;![CDATA[</span></div><div class=\"line\">    $(<span class=\"string\">\"#file\"</span>).uploadPreview(&#123; </div><div class=\"line\">        <span class=\"attr\">width</span>: <span class=\"number\">350</span>,     </div><div class=\"line\">        <span class=\"attr\">height</span>: <span class=\"number\">350</span>, </div><div class=\"line\">        <span class=\"attr\">imgDiv</span>: <span class=\"string\">'.logo-350'</span>,    </div><div class=\"line\">        <span class=\"attr\">anyTarget</span>: <span class=\"string\">'.logo-200 .content, .logo-100 .content, .logo-60 .content'</span>,</div><div class=\"line\">        <span class=\"attr\">maxSize</span>: <span class=\"number\">1024</span> * <span class=\"number\">2</span>,</div><div class=\"line\">        <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">var</span> jOption = &#123;</div><div class=\"line\">                <span class=\"attr\">setSelect</span>: [<span class=\"number\">75</span>, <span class=\"number\">75</span>, <span class=\"number\">275</span>, <span class=\"number\">275</span>],</div><div class=\"line\">                <span class=\"attr\">minSize</span>: [<span class=\"number\">200</span>, <span class=\"number\">200</span>],</div><div class=\"line\">                <span class=\"attr\">onChange</span>: updatePreview,</div><div class=\"line\">                <span class=\"attr\">onSelect</span>: updatePreview,</div><div class=\"line\">                <span class=\"attr\">aspectRatio</span>: <span class=\"number\">1</span></div><div class=\"line\">            &#125;;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">var</span> isIE = navigator.appName == <span class=\"string\">'Microsoft Internet Explorer'</span>, </div><div class=\"line\">                brVersion = navigator.appVersion, version;</div><div class=\"line\">            isIE &amp;amp;&amp;amp; (version = brVersion.split(<span class=\"string\">';'</span>)[<span class=\"number\">1</span>].replace(<span class=\"regexp\">/MSIE[ ]/g</span>,<span class=\"string\">''</span>).replace(<span class=\"string\">'.0'</span>,<span class=\"string\">''</span>));</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> (isIE &amp;amp;&amp;amp; version &lt; <span class=\"number\">10</span>) &#123;</div><div class=\"line\">                <span class=\"keyword\">var</span> api = $.Jcrop(el.selector, jOption); </div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                el.Jcrop(jOption);</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updatePreview</span>(<span class=\"params\">c</span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">parseInt</span>(c.w) &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            $(<span class=\"string\">'.logo-200, .logo-100, .logo-60'</span>).each(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">index, el</span>) </span>&#123;</div><div class=\"line\">                <span class=\"keyword\">var</span> box = $(el), content = box.find(<span class=\"string\">'.content'</span>), img = content.find(<span class=\"string\">'img'</span>);</div><div class=\"line\">                content.width($(<span class=\"string\">'.logo-350'</span>).outerWidth()).height($(<span class=\"string\">'.logo-350'</span>).outerHeight());</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">var</span> rx = box.width() / c.w;</div><div class=\"line\">                <span class=\"keyword\">var</span> ry = box.height() / c.h;</div><div class=\"line\"></div><div class=\"line\">                img.css(&#123;</div><div class=\"line\">                    <span class=\"attr\">width</span>: <span class=\"built_in\">Math</span>.round(rx * <span class=\"number\">350</span>) + <span class=\"string\">'px'</span>,</div><div class=\"line\">                    <span class=\"attr\">height</span>: <span class=\"built_in\">Math</span>.round(ry * <span class=\"number\">350</span>) + <span class=\"string\">'px'</span>,</div><div class=\"line\">                    <span class=\"attr\">marginLeft</span>: <span class=\"string\">'-'</span> + <span class=\"built_in\">Math</span>.round(rx * c.x) + <span class=\"string\">'px'</span>,</div><div class=\"line\">                    <span class=\"attr\">marginTop</span>: <span class=\"string\">'-'</span> + <span class=\"built_in\">Math</span>.round(ry * c.y) + <span class=\"string\">'px'</span></div><div class=\"line\">                &#125;);</div><div class=\"line\">            &#125;);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"><span class=\"comment\">//]]&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>","categories":[],"tags":[{"name":"jQuery","path":"api/tags/jQuery.json"},{"name":"jQuery插件","path":"api/tags/jQuery插件.json"}]}