{"title":"js文本复制全兼容实例","slug":"js-copytext","date":"2015-04-14T06:00:45.000Z","updated":"2016-11-12T19:20:58.699Z","comments":true,"path":"api/articles/js-copytext.json","excerpt":"<blockquote><p>对于文本复制本来就是<code>右键-&gt;复制</code>，或者<code>Ctrl+C</code>，很简单的事情。不过为了提升用户体验，就让我们找一个兼容性强的万全之策吧。</p></blockquote><p>纯JS实现的方式不能兼容到现代浏览器，看了Discuz和bootstrap上代码复制的实现，发现都是借用Flash来实现的。<br>","content":"<blockquote><p>对于文本复制本来就是<code>右键-&gt;复制</code>，或者<code>Ctrl+C</code>，很简单的事情。不过为了提升用户体验，就让我们找一个兼容性强的万全之策吧。</p></blockquote><p>纯JS实现的方式不能兼容到现代浏览器，看了Discuz和bootstrap上代码复制的实现，发现都是借用Flash来实现的。<br><a id=\"more\"></a></p><h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h3><p>Flash可以操作剪贴板，用一个透明的Flash覆盖到一个DOM元素上。点击DOM实际是点击了Flash，从而操作剪贴板。</p><p>需要用到一个JavaScript库：Zero Clipboard，和一个Flash文件。<br>另外要注意：<em>页面必须在放到服务器上，本地没有Flash权限。</em></p><h3 id=\"代码实例\"><a href=\"#代码实例\" class=\"headerlink\" title=\"代码实例\"></a>代码实例</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>JS文本复制<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span>&gt;</span><span class=\"css\"></span></div><div class=\"line\">    <span class=\"selector-class\">.box</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">610px</span>;</div><div class=\"line\">        <span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> auto;</div><div class=\"line\">        <span class=\"attribute\">position</span>: relative;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-tag\">textarea</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">600px</span>;</div><div class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">150px</span>;</div><div class=\"line\">        <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span>;</div><div class=\"line\">        <span class=\"attribute\">resize</span>: none;</div><div class=\"line\">        <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ddd</span>;</div><div class=\"line\">        <span class=\"attribute\">outline</span>: none;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-id\">#copy-btn</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span> <span class=\"number\">8px</span>;</div><div class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"number\">#F7F7F9</span>;</div><div class=\"line\">        <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ddd</span>;</div><div class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">4px</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"attribute\">position</span>: absolute;</div><div class=\"line\">        <span class=\"attribute\">right</span>: -<span class=\"number\">2px</span>;</div><div class=\"line\">        <span class=\"attribute\">margin-top</span>: -<span class=\"number\">30px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-id\">#clip-btn</span> &#123;</div><div class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">80px</span>;</div><div class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">40px</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"box\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>JS文本复制实例<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">textarea</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"复制的内容区\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"content\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">textarea</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"copy-btn\"</span>&gt;</span>点击复制<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"clip-btn\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"ZeroClipboard.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">  <span class=\"keyword\">var</span> clip = <span class=\"literal\">null</span>;</div><div class=\"line\">  <span class=\"comment\">// 设置Flash文件路径</span></div><div class=\"line\">  ZeroClipboard.setMoviePath(<span class=\"string\">\"ZeroClipboard.swf\"</span>);</div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">copyCode</span>(<span class=\"params\">text</span>) </span>&#123;</div><div class=\"line\">    clip = <span class=\"keyword\">new</span> ZeroClipboard.Client();</div><div class=\"line\">    <span class=\"comment\">// 设置鼠标悬浮样式 </span></div><div class=\"line\">    clip.setHandCursor(<span class=\"literal\">true</span>); </div><div class=\"line\">    <span class=\"comment\">// 点击复制</span></div><div class=\"line\">    clip.addEventListener(<span class=\"string\">'mouseOver'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">      clip.setText(text);</div><div class=\"line\">    &#125;);</div><div class=\"line\">    <span class=\"comment\">// 复制完成回调</span></div><div class=\"line\">    clip.addEventListener( <span class=\"string\">\"complete\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </div><div class=\"line\">      alert(<span class=\"string\">\"复制成功！\"</span>); </div><div class=\"line\">      clip.destroy(); <span class=\"comment\">//释放</span></div><div class=\"line\">    &#125;); </div><div class=\"line\">    <span class=\"comment\">// Flash加载的目标容器</span></div><div class=\"line\">    clip.glue(<span class=\"string\">'clip-btn'</span>);</div><div class=\"line\">  &#125;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/* js实现 */</span></div><div class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">$</span>(<span class=\"params\">id</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.getElementById(id);</div><div class=\"line\">  &#125;</div><div class=\"line\">  $(<span class=\"string\">'copy-btn'</span>).onmouseover = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> clipBtn = $(<span class=\"string\">'clip-btn'</span>);</div><div class=\"line\">    clipBtn.style.position = <span class=\"string\">'absolute'</span>;</div><div class=\"line\">    clipBtn.style.left = (e.clientX <span class=\"number\">-55</span> )+<span class=\"string\">'px'</span>;</div><div class=\"line\">    clipBtn.style.top = (e.clientY - <span class=\"number\">35</span>)+<span class=\"string\">'px'</span>;</div><div class=\"line\">    copyCode($(<span class=\"string\">'content'</span>).value);</div><div class=\"line\">  &#125;;</div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">/*jQuery实现*/</span></div><div class=\"line\">  <span class=\"comment\">// $('#copy-btn').mouseover(function() &#123;</span></div><div class=\"line\">  <span class=\"comment\">//   var t = $(this);</span></div><div class=\"line\">  <span class=\"comment\">//   var cobyText = t.prev().val();</span></div><div class=\"line\">  <span class=\"comment\">//   $('#clip-btn').css(&#123;</span></div><div class=\"line\">  <span class=\"comment\">//     position: 'absolute',</span></div><div class=\"line\">  <span class=\"comment\">//     left: t.offset().left,</span></div><div class=\"line\">  <span class=\"comment\">//     top: t.offset().top,</span></div><div class=\"line\">  <span class=\"comment\">//     zIndex: 999</span></div><div class=\"line\">  <span class=\"comment\">//   &#125;).mouseleave(function() &#123;</span></div><div class=\"line\">  <span class=\"comment\">//     clip.destroy();</span></div><div class=\"line\">  <span class=\"comment\">//   &#125;);</span></div><div class=\"line\">  <span class=\"comment\">//   copyCode(cobyText);</span></div><div class=\"line\">  <span class=\"comment\">// &#125;);</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure><hr><ol><li>参考文章：<a href=\"http://www.jb51.net/article/58413.htm\" target=\"_blank\" rel=\"external\">兼容主流浏览器的JS复制内容到剪贴板</a>&#160;<a href=\"#fnref-170:footnote\">&#8617;</a></li></ol>","categories":[],"tags":[{"name":"JavaScript","path":"api/tags/JavaScript.json"}]}